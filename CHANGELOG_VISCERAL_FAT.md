# 更新日誌：新增內臟脂肪追蹤功能

**更新日期**：2025-10-13  
**版本**：v1.1

## 📋 更新內容

### 新增功能

1. **內臟脂肪數據追蹤**
   - 從 CSV 檔案中自動讀取「內臟脂肪程度」欄位
   - 分別記錄早上和晚上的內臟脂肪測量值
   - 計算內臟脂肪的週平均、起始值、結束值和變化量

2. **內臟脂肪趨勢圖**
   - 新增內臟脂肪趨勢圖（`*_visceral_fat_trend.png`）
   - 使用橙色/紅色線條區分早上/晚上測量
   - 添加健康參考線：
     - 綠色虛線（標準：≤9.5）
     - 橙色虛線（偏高：10-14.5）
     - 過高：≥15

3. **報告增強**
   - 週報表格新增「早上內臟脂肪」和「晚上內臟脂肪」欄位
   - 統計部分顯示內臟脂肪變化趨勢
   - 總結報告中新增內臟脂肪改善成果
   - 添加內臟脂肪健康標準說明

## 📊 數據分析結果

### 內臟脂肪變化摘要（9週追蹤）

| 週次 | 起始值（AM） | 結束值（AM） | 變化 | 週平均 |
|------|------------|------------|------|--------|
| Week 1 | 21.0 | 20.0 | -1.0 | 20.2 |
| Week 2 | 19.0 | 19.0 | 0.0 | 19.0 |
| Week 3 | 19.0 | 18.0 | -1.0 | 18.6 |
| Week 4 | 18.0 | 18.0 | 0.0 | 18.0 |
| Week 5 | 18.0 | 17.0 | -1.0 | 17.7 |
| Week 6 | 17.0 | 17.0 | 0.0 | 17.2 |
| Week 7 | 17.5 | 17.0 | -0.5 | 17.1 |
| Week 8 | 17.0 | 17.0 | 0.0 | 17.0 |
| Week 9 | 17.0 | 16.0 | -1.0 | 16.8 |

### 總體成果（57天追蹤）

- **起始內臟脂肪（AM）**：21.0
- **最終內臟脂肪（AM）**：16.0
- **總改善幅度**：-5.0
- **平均值**：18.0
- **健康狀態**：從「過高」改善至「偏高」

## 🎯 健康標準參考

根據 OMRON 體脂計標準：

| 等級 | 內臟脂肪程度 | 健康建議 |
|-----|------------|---------|
| 標準 | ≤ 9.5 | 繼續保持健康生活習慣 |
| 偏高 | 10 - 14.5 | 建議增加運動，控制飲食 |
| 過高 | ≥ 15 | 需要積極改善生活方式，建議諮詢醫師 |

## 🔧 技術實現

### CSV 數據處理
```python
# 早上數據
if not am_data.empty:
    row['早上體重 (kg)'] = am_data['體重(kg)'].mean()
    row['早上體脂 (%)'] = am_data['體脂肪(%)'].mean()
    row['早上內臟脂肪'] = am_data['內臟脂肪程度'].mean()  # 新增
```

### 統計計算
```python
# 內臟脂肪統計
if sv_am is not None or sv_pm is not None:
    stats["start_visceral_am"] = sv_am
    stats["end_visceral_am"] = ev_am
    stats["delta_visceral_am"] = (ev_am - sv_am) if (sv_am and ev_am) else None
    stats["avg_visceral_am"] = float(wdf_sorted["早上內臟脂肪"].mean())
```

### 趨勢圖生成
```python
# 內臟脂肪趨勢圖
plt.figure(figsize=(8,5))
plt.plot(wdf["日期"], wdf["早上內臟脂肪"], marker="o", label="早上內臟脂肪", color='#ff7f0e')
plt.plot(wdf["日期"], wdf["晚上內臟脂肪"], marker="o", label="晚上內臟脂肪", color='#d62728')
# 添加健康參考線
plt.axhline(y=10, color='green', linestyle='--', alpha=0.5)
plt.axhline(y=15, color='orange', linestyle='--', alpha=0.5)
```

## 📁 更新的檔案

### 程式碼
- `generate_weekly_report.py`：主程式更新

### 文檔
- `README.md`：使用說明更新（需要更新）
- `CHANGELOG_VISCERAL_FAT.md`：本更新日誌

### 產出檔案
所有週報和總結報告已重新生成：
- `reports/2025-CW01/` ~ `reports/2025-CW09/`：包含內臟脂肪數據
- `reports/summary/`：包含內臟脂肪趨勢分析

每個週報新增：
- `*_visceral_fat_trend.png`：內臟脂肪趨勢圖

## 📝 使用方式

### 產生週報（含內臟脂肪）
```bash
python3 generate_weekly_report.py BodyComposition_202507-202510.csv --week-index 1
```

### 產生總結報告（含內臟脂肪）
```bash
python3 generate_weekly_report.py BodyComposition_202507-202510.csv --summary
```

### 批量重新生成所有報告
```bash
for i in {1..9}; do
  python3 generate_weekly_report.py BodyComposition_202507-202510.csv --week-index $i
done
python3 generate_weekly_report.py BodyComposition_202507-202510.csv --summary
```

## ✅ 測試結果

- ✅ 成功讀取 CSV 中的內臟脂肪數據
- ✅ 週報表格正確顯示內臟脂肪欄位
- ✅ 內臟脂肪趨勢圖正常生成
- ✅ 統計計算準確無誤
- ✅ 總結報告顯示內臟脂肪改善成果
- ✅ 所有 9 週報告重新生成成功

## 💡 重點觀察

從數據可以看出：
1. **持續改善**：內臟脂肪從 21.0 降至 16.0（降低 23.8%）
2. **穩定趨勢**：大部分週次都維持或改善，沒有反彈
3. **健康進步**：從「過高」區間改善至「偏高」區間
4. **目標明確**：距離「標準」區間（≤9.5）還需要繼續努力

## 🎯 未來建議

1. **繼續減重**：維持當前的減重策略
2. **增加運動**：特別是有氧運動，幫助降低內臟脂肪
3. **控制飲食**：減少精緻糖和不健康脂肪攝取
4. **定期監測**：持續追蹤內臟脂肪變化
5. **目標設定**：爭取在未來 3-6 個月內降至標準區間

---

**版本歷史**
- v1.1 (2025-10-13)：新增內臟脂肪追蹤功能
- v1.0 (2025-10-13)：初始版本，支援 CSV/Excel 格式
